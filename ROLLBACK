#!/bin/bash

PROJECT='/var/www/html/test'
BACKUP_PATH='/home/hunter/Desktop/backups/CURR/BACKUP.tar.gz'

#Prompt with warning
echo WARNING: This will delete all code within $PROJECT and replace it with the contents of $BACKUP_PATH/BACKUP.tar.gz. Are you ok with this? \(y/n\)
read conf

if [ "$conf" != "y" ]; then

	printf "\nK cool. Bye.\n"
	exit
fi

#IP ADDRESS ALIASES--------------------------------#


<< 'MULTILINE-COMMENT'
case $ipIN in
FE-DEV)
    ip=192.168.15.7
    name="omar"
    ;;
FE-QA)
    ip=192.168.15.6
    name="omar"
    ;;
FE-PROD)
    ip=192.168.15.8
    name="omar"
    ;;
DB1-DEV)
    ip=192.168.15.20
    name="anwarrs"
    ;;
DB1-QA)
    ip=192.168.15.24
    name="anwarrs"
    ;;
DB1-PROD)
    ip=192.168.15.19
    name="anwarrs"
    ;;
#DB2-DEV)
#    ip=192.168.15.7
#    name="anwarrs"
#    ;;
#DB2-QA)
#    ip=192.168.15.7
#    name="anwarrs"
#    ;;
#DB2-PROD)
#    ip=192.168.15.7
#    name="anwarrs"
#    ;;
BE-DEV)
    ip=192.168.15.16
    name="hunter"
    ;;
BE-QA)
    ip=192.168.15.21
    name="hunter"
    ;;
BE-PROD)
    ip=192.168.15.22
    name="hunter"
    ;;
RMQ-DEV)
    ip=192.168.15.10
    name="nouman"
    ;;
RMQ-QA)
    ip=192.168.15.25
    name="nouman"
    ;;
RMQ-PROD)
    ip=192.168.15.26
    name="nouman"
    ;;
VC)
    ip=192.168.15.23
    name="hunter"
    ;;
TEST)
    ip=192.168.15.12
    name="omar"
    ;;
 *) #default
    printf "\n No valid stage-tier given. Exiting... \n"
    exit
    ;;
esac
#-----------------------------------------------#
MULTILINE-COMMENT
#Delete project
#rm $PROJECT/*

sshpass -p ' ' ssh "hunter@10.0.3.15" << EOF
cd Desktop/backups/frontEnd;
sed -i '$ d' version.config;
tail -n 1 version.config > rollback.txt
exit;
EOF
#Extract backup to Folder
#tar xvzf $BACKUP_PATH -C /
#$sshpass -p " " ssh $name@$ip bash -c "whoami"

sshpass -p ' ' scp hunter@10.0.3.15:/home/hunter/Desktop/backups/frontEnd/rollback.txt /home/hunter/Desktop/Final

var=`tail -n 1 rollback.txt`

sshpass -p ' ' scp hunter@10.0.3.15:/home/hunter/Desktop/backups/frontEnd/$var /home/hunter/Desktop/Final

rm rollback.txt

printf "\n Rolled version backup successfully!\n"
printf "\n\n"
