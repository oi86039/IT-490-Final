#!/bin/bash

PROJECT='/var/www/html/test'
BACKUP_PATH='/home/hunter/Desktop/backups/CURR/BACKUP.tar.gz'

#Prompt with warning
echo WARNING: This will delete all code within $PROJECT and replace it with the contents of $BACKUP_PATH/BACKUP.tar.gz. Are you ok with this? \(y/n\)
read conf

if [ "$conf" != "y" ]; then

	printf "\nK cool. Bye.\n"
	exit
fi

ipIN=$(ip addr show | grep "inet " | grep -v "127.0.0.1/8" | awk '{print $2}')

echo $ipIN

#IP ADDRESS ALIASES--------------------------------#


case $ipIN in
       	192.168.15.7/24)
    		ip=192.168.15.7
    		name="omar"
    		folder="frontEnd"
		;;
	192.168.15.6/24)
	        ip=192.168.15.6
	        name="omar"
	        folder="frontEnd"
	        ;;
	192.168.15.8/24)
    		ip=192.168.15.8
    		name="omar"
    		folder="frontEnd"
    		;;
	192.168.15.20/24)
	        ip=192.168.15.20
    		name="anwarrs"
    		folder="database"
    		;;
	192.168.15.24/24)
	        ip=192.168.15.24
    		name="anwarrs"
    		folder="database"
    		;;
	192.168.15.19/24)
	        ip=192.168.15.19
    		name="anwarrs"
    		folder="database"
    		;;
	192.168.15.16/24)
    		ip=192.168.15.16
    		name="hunter"
    		folder="backEnd"
    		;;
	192.168.15.21/24)
	        ip=192.168.15.21
	        name="hunter"
    		folder="backEnd"
    		;;
	192.168.15.22/24)
    		ip=192.168.15.22
    		name="hunter"
    		folder="backEnd"
    		;;
	192.168.15.10/24)
    		ip=192.168.15.10
    		name="nouman"
    		folder="rabbitMQ"
    		;;
	192.168.15.25/24)
    		ip=192.168.15.25
    		name="nouman"
    		folder="rabbitMQ"
    		;;
	192.168.15.26/24)
    		ip=192.168.15.26
    		name="nouman"
    		folder="rabbitMQ"
    		;;
	192.168.15.23/24)
    		ip=192.168.15.23
    		name="hunter"
    		folder="VCtest"
    		;;
	10.0.3.15/24)
    		ip=10.0.3.15
    		name="hunter"
    		folder="testVM"
    		;;
	1.1.1.1)
		echo "It fricken got it"
		;;
	*)
    		printf "\n No valid stage-tier given. Exiting... \n"
    		exit
    		;;
esac

echo "It worked!!! \\(^o^)/"
#exit


#-----------------------------------------------#
#Delete project
#rm $PROJECT/*

sshpass -p ' ' ssh $name@$ip 'export $folder; bash' << EOF
cd Desktop/backups/$folder;
sed -i '$ d' version.config;
tail -n 1 version.config > rollback.txt
exit;
EOF
#Extract backup to Folder
#tar xvzf $BACKUP_PATH -C /
#$sshpass -p " " ssh $name@$ip bash -c "whoami"

sshpass -p ' ' scp hunter@10.0.3.15:/home/hunter/Desktop/backups/frontEnd/rollback.txt /home/hunter/Desktop/Final

var=`tail -n 1 rollback.txt`

sshpass -p ' ' scp hunter@10.0.3.15:/home/hunter/Desktop/backups/frontEnd/$var /home/hunter/Desktop/Final

rm rollback.txt

printf "\n Rolled version backup successfully!\n"
printf "\n\n"
